(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("./matchesonscrollbar"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","./matchesonscrollbar"],a)}else{a(CodeMirror)}}})(function(b){var j=2;var c="matchhighlight";var d=100;var m=false;function i(n){if(typeof n=="object"){this.minChars=n.minChars;this.style=n.style;this.showToken=n.showToken;this.delay=n.delay;this.wordsOnly=n.wordsOnly;this.annotateScrollbar=n.annotateScrollbar}if(this.style==null){this.style=c}if(this.minChars==null){this.minChars=j}if(this.delay==null){this.delay=d}if(this.wordsOnly==null){this.wordsOnly=m}this.overlay=this.timeout=null;this.matchesonscroll=null}b.defineOption("highlightSelectionMatches",false,function(n,p,o){if(o&&o!=b.Init){l(n);clearTimeout(n.state.matchHighlighter.timeout);n.state.matchHighlighter=null;n.off("cursorActivity",h)}if(p){n.state.matchHighlighter=new i(p);f(n);n.on("cursorActivity",h)}});function h(n){var o=n.state.matchHighlighter;clearTimeout(o.timeout);o.timeout=setTimeout(function(){f(n)},o.delay)}function a(o,s,q,p){var r=o.state.matchHighlighter;o.addOverlay(r.overlay=e(s,q,p));if(r.annotateScrollbar){var n=q?new RegExp("\\b"+s+"\\b"):s;r.matchesonscroll=o.showMatchesOnScrollbar(n,true,{className:"CodeMirror-selection-highlight-scrollbar"})}}function l(n){var o=n.state.matchHighlighter;if(o.overlay){n.removeOverlay(o.overlay);o.overlay=null;if(o.annotateScrollbar){o.matchesonscroll.clear();o.matchesonscroll=null}}}function f(n){n.operation(function(){var o=n.state.matchHighlighter;l(n);if(!n.somethingSelected()&&o.showToken){var v=o.showToken===true?/[\w$]/:o.showToken;var u=n.getCursor(),w=n.getLine(u.line),p=u.ch,q=p;while(p&&v.test(w.charAt(p-1))){--p}while(q<w.length&&v.test(w.charAt(q))){++q}if(p<q){a(n,w.slice(p,q),v,o.style)}return}var s=n.getCursor("from"),t=n.getCursor("to");if(s.line!=t.line){return}if(o.wordsOnly&&!g(n,s,t)){return}var r=n.getRange(s,t).replace(/^\s+|\s+$/g,"");if(r.length>=o.minChars){a(n,r,false,o.style)}})}function g(n,s,r){var p=n.getRange(s,r);if(p.match(/^\w+$/)!==null){if(s.ch>0){var q={line:s.line,ch:s.ch-1};var o=n.getRange(q,s);if(o.match(/\W/)===null){return false}}if(r.ch<n.getLine(s.line).length){var q={line:r.line,ch:r.ch+1};var o=n.getRange(r,q);if(o.match(/\W/)===null){return false}}return true}else{return false}}function k(o,n){return(!o.start||!n.test(o.string.charAt(o.start-1)))&&(o.pos==o.string.length||!n.test(o.string.charAt(o.pos)))}function e(p,o,n){return{token:function(q){if(q.match(p)&&(!o||k(q,o))){return n}q.next();q.skipTo(p.charAt(0))||q.skipToEnd()}}}});